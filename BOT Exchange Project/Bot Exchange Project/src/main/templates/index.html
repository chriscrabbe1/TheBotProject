<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">

    <title>Betfair</title>

    <style type="text/css">
        *{
            text-decoration: none;
        }
        .navbar{
            background: goldenrod; font-family: Verdana; padding-right: 15px; padding-left: 15px;
        }
        .navigation{
            display: flex; align-items: center; justify-content: space-between;
        }
        li{
            list-style: none; display: inline-block; <!-- remove bullet points and arrange headers on single line -->
        }
        li a{
            color: white; font-size: 18px; font-weight: bold; margin-right: 25px;
            font-style: italic; <!-- font styling and space between options -->
        }
        button{
            background-color: goldenrod; margin-left: 10px; border-radius: 10px; padding: 10px;
            width: 90px; border-color: burlywood;
        }
        button a{
            color: white; font-weight: bold;
        }
        </style>

</head>
<body>
    <nav class="navbar">
        <div class="navigation">
            <img src="https://s3-eu-west-1.amazonaws.com/tpd/logos/46dd70ea0000640005012793/0x0.png"
                 alt="Betfair Image" width="200" height="100">
            <ul>
                <li id="openBetsPath"><a href="/exchange/betting/rest/v1.0/listCurrentOrders/">
                    Open Bets</a></li>
                <button><a href="#">Sign In</a></button>
            </ul>
        </div>
    </nav>

        <div id="currentBetsDisplay"></div>

        <script>
            document.getElementById('openBetsPath').addEventListener('click', function () {
                fetchData();
            });

            async function returnSessionToken() {
                try {
                    const sessionToken = await userLogin();

                    await fetchData(sessionToken);
                } catch (error) {
                    console.error('Error: error');
                }
            }

            async function userLogin() {
                try {
                   const loginResponse = await fetch('/api/login?username=rgssTZlPyFz6Cmnmbl&password=P@rola03', {
                       method: 'POST',
                       headers: {
                           'Content-Type': 'application/json',
                           'Accept': 'application/json',
                           'X-Application': 'npo67wopV4oKVu5g',
                       }
                   });

                   if (loginResponse.ok) {
                       const loginData = await loginResponse.json();
                       return loginData.sessionToken;
                       console.log(returnSessionToken());
                   } else {
                       console.error('Sorry, Login Failed: ', loginResponse.statusText)
                       throw new Error('Login Failed');
                   }
                } catch (error) {
                    console. error ('Login error: ', error)
                    throw error;
                }
            }

            async function fetchData() {
                try {
                    const response = await fetch('/exchange/betting/rest/v1.0/listCurrentOrders/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json',
                            'X-Application': 'npo67wopV4oKVu5g',
                            'X-Authentication': returnSessionToken(),
                        }
                    })

                    if (response.ok) {
                        const expectedData = await response.text();
                        document.getElementById('openBetsPath').innerText = expectedData;
                    } else {
                        console.error('Error: ', response.statusText);
                    }
                } catch (error) {
                    console.error('Sorry, error encountered: ', error);
                }
            }
        </script>


</body>
</html>